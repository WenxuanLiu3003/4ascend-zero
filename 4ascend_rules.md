# 4ascend 游戏规则（Markdown 版）

## 一、基本设定
- **棋盘**：9×9 方格。
- **玩家**：黑、白双方，轮流落子。
- **血量（HP）**：双方初始血量（建议 20，可协商设定）。
- **子力**：由达成“≥4 子相连”的棋子在结算时转换的攻击/防御力量。

## 二、连子与计数
- **触发条件**：当任意一方在其落子后形成“≥4 子相连”（横/竖/斜均可），立即进入“攻击-防守状态”。
- **多条四连**：同一回合内可同时触发多条连子；**计数时按参与连子的“唯一棋子集合的总数”**，避免重复计数。
- **五连及以上**：按实际参与的棋子数计入（例如“五连”计 5）。
- **连子消去**：触发方（或防守方在其落子后再次触发时）的所有连子棋子从棋盘上移除。被移除的位置在当回合内可以被对手落子占据（见下面的攻防流程）。

## 三、植物（资源格）
- **刷新**：棋局过程中会在未落子处**不定期随机刷新植物**；此外，**每次“攻击-防守状态”结算结束后**，也会**立刻**在空位随机刷新新的植物。（数量与频率可协商设定）
- **效用**：若某方的连子包含了植物所在格，则这些植物在**结算**时为该方**每格 +1 子力**。植物是否计入，取决于该格在结算时是否仍被该方“占据/有效”。

## 四、回合与攻防流程
1. **正常状态**：双方轮流在空位落子。
2. **进入攻防**：谁先在其落子后达成“≥4 子相连”，谁就是**攻击方**，并立刻将其所有连子从棋盘上移除（这些“消去位置”此时为空位）。
3. **防守方落子**：
   - 防守方必须**立即落子**；可以落在任意空位，包括攻击方刚刚被消去的位置（若防守方落在这些格子上，则该格在结算时视为“被防守方占据”）。
   - 若防守方此步也形成“≥4 子相连”，则防守方的连子也会被移除，其“消去位置”随即用于结算。
4. **结算子力（统一规则）**：
   - **攻击方子力** = 攻击方本次被消去的棋子位置中，**在结算时仍未被防守方占据**的格子数 **+** 这些格子上（同样未被防守方占据的）**植物数**。
   - **防守方子力** = 防守方本次被消去的**棋子数** **+** 其消去位置上的**植物数**。（防守方是后下，其被消去的位置在结算时不可能被对手占据）
   - 说明：若防守方未形成连子，则其“被消去的棋子数 = 0，植物数 = 0”，即 **防守方子力 = 0**。
5. **血量结算**：双方子力相互抵消；子力较少的一方扣除等于**子力差额**的血量。
6. **退出攻防**：结算完成后，棋盘保持已移除后的状态；**立刻在空位随机刷新新的植物**，然后回到“正常状态”，继续轮流落子。

> 注：采用上述统一结算规则后，“无效化”的直观效果自然体现：
> - 若防守方在攻防阶段将子落在攻击方的“消去位置”上，则该格**不再为攻击方计入子力**；
> - 若该格原先有植物，则攻击方也**失去该植物的加成**；
> - 同时，防守方若本回合形成连子并消去，**其消去位置中的植物都会计入其子力**。

## 五、胜负判定
- 当任意一方 HP ≤ 0 时，立即判负；另一方获胜。

## 六、建议的可配置参数
- 初始 HP（如 15/20/30）。
- 植物每次刷新数量与频率（可固定数量或区间）。
- 平局判定（可选）：达到最大步数仍无人被击败时，可根据剩余 HP 判胜/判和。

## 七、补充说明（实现/裁判器建议）
- **去重计数**：当同一棋子属于多条连子时，计子力只应计算一次。
- **合法落点**：棋盘上空格为合法落点；进入攻防后，攻击方的“消去位置”立即视为空格，可被防守方落子。
- **随机性**：游戏的随机性仅来自植物的随机刷新；其它规则均为完全确定的对弈。
